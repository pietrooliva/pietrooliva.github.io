<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Augmented Reality with GLTF Model</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.1.0/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.123.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.123.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

<a-scene embedded arjs>
    <a-assets>
        <a-asset-item id="burnerModel" src="models/burner/scene.gltf"></a-asset-item>
    </a-assets>

    <a-marker preset="hiro">
        <a-entity id="burner" gltf-model="#burnerModel" scale="0.1 0.1 0.1" position="0 0 0" rotation="0 0 0"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<script>
    document.addEventListener('gesturestart', function (e) {
        e.preventDefault();
    });

    document.addEventListener('gesturechange', function (e) {
        e.preventDefault();
        var scale = 0.1 * e.scale;
        var burner = document.querySelector('#burner');
        burner.setAttribute('scale', `${scale} ${scale} ${scale}`);
    });

    let startRotation = { x: 0, y: 0 };
    let currentRotation = { x: 0, y: 0 };
    let rotating = false;

    document.addEventListener('touchstart', function (event) {
        if (event.touches.length === 1) {
            rotating = true;
            startRotation.x = event.touches[0].pageX;
            startRotation.y = event.touches[0].pageY;
        }
    });

    document.addEventListener('touchmove', function (event) {
        if (rotating && event.touches.length === 1) {
            let deltaX = event.touches[0].pageX - startRotation.x;
            let deltaY = event.touches[0].pageY - startRotation.y;

            currentRotation.x += deltaY * 0.1;
            currentRotation.y += deltaX * 0.1;

            let burner = document.querySelector('#burner');
            burner.setAttribute('rotation', `${currentRotation.x} ${currentRotation.y} 0`);
        }
    });

    document.addEventListener('touchend', function (event) {
        if (event.touches.length === 0) {
            rotating = false;
        }
    });

    let isPanning = false;
    let panStart = { x: 0, y: 0 };
    let panCurrent = { x: 0, y: 0 };

    document.addEventListener('touchstart', function (event) {
        if (event.touches.length === 3) {
            isPanning = true;
            panStart.x = event.touches[0].pageX;
            panStart.y = event.touches[0].pageY;
        }
    });

    document.addEventListener('touchmove', function (event) {
        if (isPanning && event.touches.length === 3) {
            let deltaX = event.touches[0].pageX - panStart.x;
            let deltaY = event.touches[0].pageY - panStart.y;

            panCurrent.x += deltaX * 0.1;
            panCurrent.y += deltaY * 0.1;

            let burner = document.querySelector('#burner');
            burner.object3D.position.x += panCurrent.x;
            burner.object3D.position.y += panCurrent.y;

            panStart.x = event.touches[0].pageX;
            panStart.y = event.touches[0].pageY;
        }
    });

    document.addEventListener('touchend', function (event) {
        if (event.touches.length < 3) {
            isPanning = false;
        }
    });

    // Debugging logs
    document.querySelector('#burnerModel').addEventListener('load', function () {
        console.log('GLTF Model loaded successfully');
    });

    document.querySelector('#burnerModel').addEventListener('error', function () {
        console.error('Failed to load GLTF Model');
    });

    document.querySelector('a-scene').addEventListener('loaded', function () {
        console.log('A-Frame scene loaded');
    });

</script>

</body>
</html>
