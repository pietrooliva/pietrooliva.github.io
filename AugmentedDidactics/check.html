<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>COSMOGONIE & COSMOLOGIE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script src="libs/aframe-master.min.js"></script>
    <script src="libs/aframe-ar.js"></script>
    <script src="libs/AR.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="libs/gesture-detector.js"></script>
</head>
<body>
    <!-- Schermata iniziale -->
    <div id="start-screen" style="
        position: absolute; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%); 
        z-index: 10; 
        background: #000; 
        color: #fff; 
        padding: 20px; 
        text-align: center; 
        font-family: Arial, sans-serif; 
        cursor: pointer;">
        <h1>Tocca per iniziare</h1>
        <p>Consenti al browser di riprodurre audio e accedere alla fotocamera.</p>
    </div>

    <!-- Scena A-Frame -->
    <a-scene 
        gesture-detector 
        embedded 
        arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" 
        renderer="precision: medium;" 
        style="display: none;">
        
        <a-assets>
            <a-asset-item id="model" src="models/yale_tablet/scene.gltf"></a-asset-item>
            <audio id="background-audio" src="models/yale_tablet/background.mp3" playsinline></audio>
        </a-assets>

        <a-marker type="barcode" value="30">
            <a-entity 
                gltf-model="#model"
                scale="0.05 0.05 0.05"
                rotation="-90 180 180"
                class="clickable"
                interaction-handler></a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <!-- Bottone per controllare l'audio -->
    <button id="audio-control" style="
        position: absolute; 
        bottom: 20px; 
        left: 50%; 
        transform: translateX(-50%); 
        z-index: 10; 
        background: rgba(0, 0, 0, 0.7); 
        color: #fff; 
        border: none; 
        padding: 10px 20px; 
        border-radius: 20px; 
        font-family: Arial, sans-serif; 
        cursor: pointer; 
        display: none;">
        Riproduci Audio
    </button>

    <script>
        // Schermata iniziale
        document.getElementById('start-screen').addEventListener('click', function () {
            const audio = document.querySelector('#background-audio');
            const scene = document.querySelector('a-scene');
            const audioButton = document.getElementById('audio-control');
            
            // Tentativo di riprodurre l'audio iniziale
            audio.play().then(() => {
                console.log('Audio avviato con successo.');
            }).catch((error) => {
                console.warn('Autoplay non consentito. Richiesta interazione manuale.');
            });

            // Mostra la scena e nasconde la schermata iniziale
            scene.style.display = 'block';
            document.getElementById('start-screen').style.display = 'none';

            // Mostra il pulsante per il controllo dell'audio
            audioButton.style.display = 'block';
        });

        // Controllo audio tramite bottone
        document.getElementById('audio-control').addEventListener('click', function () {
            const audio = document.querySelector('#background-audio');
            
            if (audio.paused) {
                audio.play().then(() => {
                    console.log('Audio riprodotto.');
                    this.textContent = 'Pausa Audio';
                }).catch((error) => {
                    console.error('Impossibile riprodurre l\'audio:', error);
                });
            } else {
                audio.pause();
                this.textContent = 'Riproduci Audio';
                console.log('Audio in pausa.');
            }
        });

        // Componente per interazioni avanzate (come nel codice precedente)
        AFRAME.registerComponent('interaction-handler', {
            init: function () {
                // Configurazione delle interazioni (mouse, touch, ecc.)
                // Pu√≤ essere lasciato invariato rispetto alla versione precedente.
            },
        });
    </script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</body>
</html>
